schema: '2.0'
stages:
  sync_negative_train_samples:
    cmd: aws s3 cp s3://ezra-ml-dvc/reporter/df_negative_for_train_and_stats.csv ./data/df_negative_for_train_and_stats.csv
    deps:
    - path: s3://ezra-ml-dvc/reporter/df_negative_for_train_and_stats.csv
      etag: f6b1f978f37012919aaefc68fe6e07e7
      size: 1592506
    outs:
    - path: data/df_negative_for_train_and_stats.csv
      md5: f6b1f978f37012919aaefc68fe6e07e7
      size: 1592506
  sync_positive_train_samples:
    cmd: aws s3 cp s3://ezra-ml-dvc/reporter/df_positive_w_id_for_train_and_stats.csv
      ./data/df_positive_w_id_for_train_and_stats.csv
    deps:
    - path: s3://ezra-ml-dvc/reporter/df_positive_w_id_for_train_and_stats.csv
      etag: 60d30f28dbc13dd65f763d97f7d0a802
      size: 3761166
    outs:
    - path: data/df_positive_w_id_for_train_and_stats.csv
      md5: cb351a0d8e69b4cb263e6265bb5bfff2
      size: 3761166
  sync_snippet_database:
    cmd: aws s3 cp s3://ezra-ml-dvc/reporter/cleaned_snippets_with_org_name_new_rows.csv
      ./data/cleaned_snippets_with_org_name_new_rows.csv
    deps:
    - path: s3://ezra-ml-dvc/reporter/cleaned_snippets_with_org_name_new_rows.csv
      etag: 945af0c2c6c3518377534b8740b0a0a5
      size: 799345
    outs:
    - path: data/cleaned_snippets_with_org_name_new_rows.csv
      md5: 5376aeada62a4fb140929455ffe52e76
      size: 799345
  sync_uml_sbert:
    cmd: aws s3 cp s3://ezra-ml-dvc/reporter/UMLSBert ./data/UMLSBert --recursive
    deps:
    - path: s3://ezra-ml-dvc/reporter/UMLSBert/config.json
      etag: 1548c9643eaee9881e522896ebc96396
      size: 605
    - path: s3://ezra-ml-dvc/reporter/UMLSBert/pytorch_model.bin
      etag: f4890ddef1813d95f0b2c3ec7b469d46-53
      size: 438007537
    - path: s3://ezra-ml-dvc/reporter/UMLSBert/vocab.txt
      etag: 7f5029172a4e3c1198f13c92bdb06d89
      size: 225062
    outs:
    - path: data/UMLSBert/config.json
      md5: 1548c9643eaee9881e522896ebc96396
      size: 605
    - path: data/UMLSBert/pytorch_model.bin
      md5: e51a431feca65ed1e7784312cf1af54d
      size: 438007537
    - path: data/UMLSBert/vocab.txt
      md5: 7f5029172a4e3c1198f13c92bdb06d89
      size: 225062
  embed_umlsbert_snippets:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.embed_snippets_umlsbert
      ."
    deps:
    - path: ai/data_pipeline/embed_snippets_umlsbert/__init__.py
      md5: 233fafc1540d81445e0bb9ad844d4a5d
      size: 2345
    - path: ai/data_pipeline/embed_snippets_umlsbert/__main__.py
      md5: d0d8170aef7d5d0e5662af9ca9cd4eb0
      size: 254
    - path: data/UMLSBert/config.json
      md5: 1548c9643eaee9881e522896ebc96396
      size: 605
    - path: data/UMLSBert/pytorch_model.bin
      md5: e51a431feca65ed1e7784312cf1af54d
      size: 438007537
    - path: data/UMLSBert/vocab.txt
      md5: 7f5029172a4e3c1198f13c92bdb06d89
      size: 225062
    - path: data/cleaned_snippets_with_org_name_new_rows.csv
      md5: 5376aeada62a4fb140929455ffe52e76
      size: 799345
    outs:
    - path: data/embed_snippets_umlsbert.parquet
      md5: 1fc157815ff8c01647d71a9355b923f0
      size: 9961281
  sync_bio_sent:
    cmd: aws s3 cp s3://ezra-ml-dvc/reporter/bioSent2Vec.bin ./data/bioSent2Vec.bin
    deps:
    - path: s3://ezra-ml-dvc/reporter/bioSent2Vec.bin
      etag: 9f3ca0f37ada92f6dc6643d59cd51d82-2680
      size: 22475736490
    outs:
    - path: data/bioSent2Vec.bin
      md5: e0c6c5cf7e4f8e88ec253ee46b461e58
      size: 22475736490
  embed_biosent_snippets:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.embed_snippets_biosent
      ."
    deps:
    - path: ai/data_pipeline/embed_snippets_biosent/__init__.py
      md5: 3e6354d8540e04295008090b7db112d4
      size: 2159
    - path: ai/data_pipeline/embed_snippets_biosent/__main__.py
      md5: 94ac76570d1c72169c160c4b73b57c10
      size: 252
    - path: data/bioSent2Vec.bin
      md5: e0c6c5cf7e4f8e88ec253ee46b461e58
      size: 22475736490
    - path: data/cleaned_snippets_with_org_name_new_rows.csv
      md5: 5376aeada62a4fb140929455ffe52e76
      size: 799345
    outs:
    - path: data/embed_snippets_biosent.parquet
      md5: cec4459079bbe4b666bbe5aa500527a4
      size: 9106322
  generate_training_samples:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.generate_training_samples
      ."
    deps:
    - path: ai/data_pipeline/generate_training_samples/__init__.py
      md5: e00de7129b42ebd3b657feedc3e8fff4
      size: 3341
    - path: ai/data_pipeline/generate_training_samples/__main__.py
      md5: bddc9ff3357bab4ccf6c0218a8cfc36d
      size: 256
    - path: data/df_negative_for_train_and_stats.csv
      md5: f6b1f978f37012919aaefc68fe6e07e7
      size: 1592506
    - path: data/df_positive_w_id_for_train_and_stats.csv
      md5: cb351a0d8e69b4cb263e6265bb5bfff2
      size: 3761166
    outs:
    - path: data/training_samples.parquet
      md5: f786a1a0f43a8abdffdca36e2a5e36f5
      size: 148993
  generate_corpus:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.generate_corpus
      ."
    deps:
    - path: ai/data_pipeline/generate_corpus/__init__.py
      md5: c43d25f486aacd8af1b467cba665f1e3
      size: 1116
    - path: ai/data_pipeline/generate_corpus/__main__.py
      md5: e7c69f6ce808a6c40dea70161553c93b
      size: 87
    - path: data/cleaned_snippets_with_org_name_new_rows.csv
      md5: 5376aeada62a4fb140929455ffe52e76
      size: 799345
    outs:
    - path: data/corpus.npy
      md5: e5322ad566d1d16ddf4f36695e072234
      size: 85060
  embed_umlsbert_finding:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.embed_finding_umlsbert
      ."
    deps:
    - path: ai/data_pipeline/embed_finding_umlsbert/__init__.py
      md5: 3507e2c260d1923b2f57ed87674e1987
      size: 2352
    - path: ai/data_pipeline/embed_finding_umlsbert/__main__.py
      md5: 697fce12999071cf5c64234c3ff6a0c9
      size: 253
    - path: data/training_samples.parquet
      md5: f786a1a0f43a8abdffdca36e2a5e36f5
      size: 148993
    outs:
    - path: data/embed_finding_umlsbert.parquet
      md5: c5bc759fe9815d1974af6ffd7683a11b
      size: 87831425
  embed_biosent_finding:
    cmd: docker-compose run ml.thageesan "python -m ai.data_pipeline.embed_finding_biosent
      ."
    deps:
    - path: ai/data_pipeline/embed_finding_biosent/__init__.py
      md5: 8392193df190259e40ebdcb94d4e9dfa
      size: 2162
    - path: ai/data_pipeline/embed_finding_biosent/__main__.py
      md5: e7a0a2e61bad8a4d0a95b6aa933450fd
      size: 252
    - path: data/training_samples.parquet
      md5: f786a1a0f43a8abdffdca36e2a5e36f5
      size: 148993
    outs:
    - path: data/embed_finding_biosent.parquet
      md5: b84ef1b0ce89266e77b0072df3c88aff
      size: 80526054
